<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Product Search</title>

  <!-- Optional: simple CSP that allows inline-scripts/styles only if you trust them.
       If you add a strict CSP, ensure 'unsafe-inline' is allowed or move inline code to files. -->
  <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' https:"> -->

  <!-- Favicon (optional) -->
  <link rel="icon" href="/static/favicon.ico" />
</head>
<body>
  <!-- script.js will create the full UI (inject styles + elements) -->
  <script>
    // Override the sendMessage function to handle multilingual responses
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for original script to load, then override
      setTimeout(function() {
        const originalAddMessage = window.addMessage;
        if (originalAddMessage) {
          window.addMessage = function(content, isUser = false, intent = null, confidence = null) {
            // Parse multilingual response structure
            if (!isUser && typeof content === 'string' && content.includes("'recommendations'")) {
              try {
                // Extract JSON from string
                const jsonMatch = content.match(/\{[^}]+\}/g);
                if (jsonMatch) {
                  const parsed = JSON.parse(jsonMatch[0].replace(/'/g, '"'));
                  if (parsed.recommendations) {
                    // Render as rich cards
                    const pitch = parsed.pitch || '';
                    const recs = parsed.recommendations.slice(0, 3);
                    let html = pitch ? `<div style="margin-bottom:8px;font-weight:600">${pitch}</div>` : '';
                    
                    recs.forEach(r => {
                      const img = r.image ? `<img src="${r.image}" style="width:100px;height:80px;object-fit:cover;border-radius:8px;margin-right:12px;">` : '';
                      html += `<div style="display:flex;gap:12px;padding:10px;border:1px solid #f3f4f6;border-radius:10px;margin-bottom:10px;">
                        ${img}
                        <div>
                          <div style="font-weight:600;">${r.name}</div>
                          <div style="color:#059669;font-weight:600;">$${r.price}</div>
                          <div style="font-size:0.75rem;color:#6b7280;">${r.category}</div>
                        </div>
                      </div>`;
                    });
                    content = html;
                  }
                }
              } catch (e) {}
            }
            return originalAddMessage(content, isUser, intent, confidence);
          };
        }
      }, 1000);
    });
  </script>
  <script src="/static/script.js?v=5" defer></script>
</body>
</html>
